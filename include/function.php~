<?php
include 'connect.php';
?>
<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../css/bootstrap.min.css">
<script src="../js/jquery-1.11.3.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
</head>
<?php
//header('Content-Type: text/html; charset=iso-8859-1');
/*
 *  Arquivo de funções diversas (PHP e Javascript)
 * ===============================================
 * 
 * FUNÇÕES PHP
 * 
 */
function sessao(){
	if(!isset($_SESSION)) session_start();
	if(!isset($_SESSION["senhabloq"]) OR ($_SESSION["senhabloq"] == '1')) {
		session_destroy();
		header('Location: index.php');
		exit;
	}
} //fim sessao

//function para mudar a imagem para base64 (blob)
function changeImagetoBase64($image){
	$path = $image;
	$type = pathinfo($path, PATHINFO_EXTENSION);
	$data = file_get_contents($path);
	$base64 = 'data:image/'.$type.';base64,' . base64_encode($data);
	return $base64;
}

//function para esvaziar diretorio de fotos
//fonte:https://paulund.co.uk/php-delete-directory-and-files-in-directory
function delete_directory($dirname) {
	if (is_dir($dirname))
		$dir_handle = opendir($dirname);
		if (!$dir_handle)
			return false;
			while($file = readdir($dir_handle)) {
				if ($file != "." && $file != "..") {
					if (!is_dir($dirname."/".$file))
						unlink($dirname."/".$file);
						else
							delete_directory($dirname.'/'.$file);
				}
			}
			closedir($dir_handle);
			rmdir($dirname);
			return true;
}

//Somente numeros na string
function limpaLetras($str) {
    return preg_replace("/[^0-9]/", "", $str);
}

function outputCSV($data,$file_name = 'export.csv') {
       # output headers so that the file is downloaded rather than displayed
        header("Content-Type: text/csv");
        header("Content-Disposition: attachment; filename=$file_name");
        # Disable caching - HTTP 1.1
        header("Cache-Control: no-cache, no-store, must-revalidate");
        # Disable caching - HTTP 1.0
        header("Pragma: no-cache");
        # Disable caching - Proxies
        header("Expires: 0");
    
        # Start the ouput
        $output = fopen("php://output", "w");
        fputcsv($fp,array('CodigoFC','CodigoDec','Wiegand'));
         # Then loop through the rows
        foreach ($data as $row) {
            # Add the rows to the body
            fputcsv($output, $row); // here you can change delimiter/enclosure
        }
        # Close the stream off
        fclose($output);
    }
?>
<script type="text/javascript">
/*
 * FUNÇÕES JavaScript
 */
 
//funcao envia com enter
function envio() {
    var txt = "";
    if (document.getElementById("nome").validity.valueMissing) {
    	txt = "<p class='bg-warning' align='center'>É necessário preencher o nome!</p>";
    } else if (document.getElementById("empresa").validity.valueMissing) {
    	txt = "<p class='bg-warning' align='center'>Selecione a empresa!</p>";
    } else {
        document.getElementById("cadastro").submit();
    }
    document.getElementById("msgerr").innerHTML = txt;
}

//exportar csv
function Export()
        {
            var conf = confirm("Export users to CSV?");
            if(conf == true)
            {
                window.open("export.php", '_blank');
            }
        }
        
</script>
<?php

?>
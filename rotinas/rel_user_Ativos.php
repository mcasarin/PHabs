<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../css/bootstrap.min.css">
<script src="../js/jquery-1.12.4.js"></script>
<script src="../js/jquery-ui-1.12.1.js"></script>
<script src="../js/bootstrap.min.js"></script>
</head>
<html>
<body>
<?php
// print Errors
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

include '../include/function.php';
include '../include/connect.php';
sessao();

// Declaração de variaveis
$nome = "";
$empresa = "";
$matricula = "";
$cartao = "";
$coletor = "";
$id = "";
$data = "";
$hora = "";
$acesso = "";
$datainicio = "";
$datafim = "";

$arrayMatriculas = array(2990,
4586,
9420,
3393,
5947,
5769,
16112,
16111,
5822,
5766,
5767,
5990,
5725,
5986,
5984,
5983,
5982,
5980,
5979,
5978,
5977,
8282,
9790,
9793,
5976,
5975,
5974,
5973,
5972,
5971,
4304,
5970,
5969,
5968,
5967,
5965,
5964,
5963,
5962,
5961,
5960,
5959,
5958,
5957,
5956,
5955,
5954,
5953,
5951,
16107,
16108,
16109,
16110,
5950,
6065,
6068,
5946,
1930,
5945,
5944,
5943,
5942,
5941,
5940,
5939,
4186,
5938,
5936,
5934,
5933,
5932,
1305,
5931,
5929,
5735,
16105,
16106,
5726,
3917,
5664,
3000,
2623,
5927,
2608,
8118,
2781,
3991,
5728,
5737,
5736,
5733,
5732,
5730,
5740,
5738,
16195,
5850,
16194,
5833,
5832,
5831,
5830,
5829,
5828,
5827,
5826,
5825,
5824,
5823,
2864,
2889,
5821,
5820,
1877,
5819,
5818,
5760,
5752,
5751,
5817,
5816,
5761,
5789,
5815,
5814,
5813,
5811,
5812,
5810,
8281,
3451,
5809,
5808,
5807,
5937,
5935,
5806,
5805,
5966,
5949,
5989,
5804,
5803,
5802,
5801,
5799,
5798,
5797,
5796,
5795,
5794,
16193,
5793,
5792,
5791,
1026,
5790,
16192,
5787,
5786,
5785,
5783,
5782,
5780,
5779,
5778,
5777,
5776,
5775,
5774,
5772,
5771,
5770,
5768,
5765,
5764,
5762,
5759,
5758,
5757,
5756,
5755,
5754,
5753,
1369,
1371,
5750,
5749,
5748,
5747,
5746,
5745,
5744,
5743,
5742,
5741,
5739,
5734,
5731,
5727,
2166,
2193,
2335,
2336,
2808,
2816,
2879,
2907,
2934,
2971,
3334,
3373,
5703,
5704,
5706,
6245,
7238,
7244,
5928,
5952,
5948,
5784,
5781,
5773,
5763,
5788,
5987,
5152,
5981,
5988,
5578,
529,
528,
526,
5665,
5666,
6022,
592,
6147,
6383,
6385,
6391,
6481,
6644,
6691,
6844,
6845,
7084,
7085,
7098,
7190,
7202,
7203,
7204,
7205,
7207,
7209,
7210,
7219,
7277,
7278,
7282,
7283,
7285,
16173,
7328,
7329,
7330,
7331,
7332,
7333,
7334,
7335,
7336,
7412,
7414,
7421,
7425,
7430,
7431,
7435,
7436,
7440,
7445,
7482,
7483,
7484,
7499,
7500,
7501,
7502,
7503,
7698,
7551,
7552,
7553,
7554,
7555,
7556,
7557,
7558,
7559,
7560,
7561,
7562,
7563,
7564,
7565,
7577,
16151,
16150,
7701,
7702,
7703,
7704,
7707,
7712,
7713,
7716,
7717,
7778,
7781,
7784,
7785,
7788,
7791,
7792,
7793,
7795,
7833,
7834,
7835,
7836,
7837,
7838,
7840,
7841,
7842,
7843,
7848,
7874,
7875,
7876,
7962,
7963,
7970,
8046,
8049,
8050,
8051,
8056,
8059,
8062,
8159,
8285,
8288,
8289,
8290,
8344,
8345,
8346,
8347,
8349,
8498,
8505,
8506,
8513,
8516,
8617,
8621,
8642,
8646,
8700,
8701,
8723,
8744,
8800,
8801,
8802,
8804,
8806,
8808,
8817,
8821,
8822,
9019,
9084,
9085,
9106,
9107,
9108,
9115,
9110,
9112,
9113,
16149,
9150,
9155,
9152,
9153,
9171,
9172,
9190,
9191,
9212,
9213,
9214,
1245,
1261,
1262,
9424,
16122,
1270,
1271,
1272,
1273,
1274,
1816,
1978,
2005,
2035,
2122,
2181,
2592,
2614,
2836,
2855,
2868,
2869,
3235,
3321,
3323,
3337,
3345,
3376,
3382,
16148,
3659,
3660,
3661,
3663,
3664,
3667,
3668,
3673,
103674,
3675,
3713,
3714,
3718,
3720,
3721,
3722,
3724,
103747,
3748,
103750,
3765,
3769,
3774,
3776,
3818,
103822,
3833,
103836,
103995,
4003,
4012,
4314,
4344,
4351,
104516,
4517,
104526,
4527,
4512,
16217,
4580,
104582,
4633,
104635,
4636,
4637,
104640,
4641,
104644,
4645,
104646,
4650,
104651,
4652,
104654,
4657,
4658,
104660,
4761,
4762,
4763,
16216,
16215,
16214,
4798,
4823,
4825,
4833,
4837,
4841,
4847,
16147,
4939,
4940,
4941,
4942,
4944,
4945,
5058,
5059,
5061,
5063,
5092,
5097,
5099,
5158,
5160,
5214,
5215,
5217,
105258,
105296,
5361,
105363,
5368,
5373,
5378,
105387,
5389,
5390,
105391,
5392,
5418,
5428,
5431,
5474,
5513,
105515,
105602,
5604,
5607,
105609,
6170,
6171,
6172,
6173,
106174,
106191,
106192,
1421,
1506,
1518,
1563,
1564,
1587,
7402,
7496,
7923,
7926,
7928,
7932,
8467,
9423,
9224,
9225,
9254,
9256,
9258,
9273,
9274,
9276,
9277,
9278,
9292,
9294,
9317,
9333,
9334,
9336,
9337,
9370,
9371,
9372,
9466,
9467,
9486,
9487,
9489,
9491,
9492,
9493,
9500,
9502,
9504,
9510,
9512,
9515,
9595,
9597,
9601,
9655,
9662,
9663,
9664,
9699,
868,
9720,
9724,
9725,
9726,
9727,
9728,
9729,
9730,
9731,
9740,
9741,
9763,
9762,
9761,
9759,
9760,
9758,
9764,
9775,
9776,
9777,
9778,
9794,
9792,
9789,
9791,
9834,
9835,
9847,
9848,
9849,
9850,
9865,
9871,
9872,
9879,
9880,
9883,
9884,
9896,
9897,
9898,
9899,
9900,
9901,
9902,
9913,
9914,
9915,
9916,
9917,
9918,
9919,
9920,
9927,
9928,
9930,
9950,
9951,
9965,
9966,
9968,
9970,
1289,
3512,
6979,
8320,
8478,
8607,
8610,
8620,
8653,
8655,
9248,
9251,
9252,
9363,
9366,
9368,
9374,
9381,
9382,
9416,
9417,
9418,
9421,
9425,
9432,
9524,
9563,
9587,
9599,
9600,
9634,
9635,
9677,
9678,
9679,
9688,
9681,
9683,
9684,
9686,
9687,
10020,
10040,
10041,
10043,
10062,
10063,
10064,
10065,
10066,
10067,
10068,
10069,
10092,
10093,
10094,
10095,
10096,
10097,
10098,
10099,
10100,
10101,
10102,
10103,
10104,
10105,
10106,
10127,
10128,
10151,
10152,
10153,
10155,
10161,
10162,
10196,
10198,
10223,
10224,
10225,
10226,
10227,
10228,
10229,
10230,
10242,
10246,
10247,
10248,
10269,
10270,
10288,
10289,
10290,
10291,
10304,
10305,
10318,
10338,
10349,
10350,
10351,
10373,
10381,
10382,
10383,
10384,
10385,
10386,
10400,
10401,
10402,
10403,
10404,
10405,
10406,
10407,
10408,
10409,
10433,
10434,
10435,
10444,
10447,
10449,
10450,
10451,
10452,
10453,
10454,
10482,
10483,
10484,
10485,
10486,
10487,
10488,
10489,
10490,
10491,
10492,
10493,
10531,
10532,
10543,
10544,
10546,
10547,
10548,
10595,
10596,
10597,
10599,
10600,
10601,
10602,
10603,
10604,
10642,
10643,
10644,
10662,
10663,
10664,
10667,
10668,
10700,
10701,
10736,
10749,
10750,
10760,
10761,
10762,
10763,
10764,
10765,
10766,
10767,
10799,
10820,
10821,
10822,
10823,
10824,
10825,
10847,
10848,
10875,
10891,
10892,
10893,
10894,
10895,
10897,
10898,
10899,
10900,
10901,
10902,
10903,
10929,
10930,
10931,
10932,
10933,
10934,
10950,
10951,
10953,
10954,
10955,
10956,
10971,
10972,
10973,
10974,
10975,
10995,
10996,
10997,
11018,
11019,
11020,
11021,
11022,
11080,
11120,
11121,
11122,
11125,
11147,
11168,
11188,
11189,
11190,
11203,
11204,
11222,
11231,
11232,
11242,
11243,
11268,
11314,
11358,
11359,
11360,
11361,
11362,
11363,
11381,
11382,
11383,
11384,
11385,
11395,
11403,
11419,
11420,
11425,
11438,
11439,
11440,
11452,
11453,
11454,
11483,
11505,
11506,
11507,
11514,
11521,
11522,
11523,
11571,
11594,
11595,
11608,
11639,
11656,
11657,
11658,
11659,
11660,
11661,
11662,
11677,
11692,
11693,
11694,
11709,
11710,
11711,
11735,
11736,
11737,
11746,
11747,
11748,
11749,
11762,
11763,
11764,
11797,
11817,
11818,
11819,
11820,
11857,
11858,
11872,
11873,
11874,
11875,
11901,
11921,
11949,
11966,
11967,
11979,
11980,
12004,
12005,
12023,
12024,
12029,
16007,
16008,
16009,
16010,
16011,
16019,
16020,
16071,
16072,
16073,
16074,
16090,
16091,
16223,
16239,
16240,
16241,
16314,
16315,
16316,
16327,
16328,
16350,
16351,
16352,
16353,
16354,
16375,
16401,
16402,
16699,
17033);

//botao voltar
$voltar = "<form action=\"index.php\" method=\"post\">
<button class=\"btn btn-sm btn-warning btn-block\" type=\"submit\" name=\"reload\" role=\"button\"> Voltar ao início </button>
</form>";
//botao tentar novamente
$tentarnovamente = "<form action=\"select_user.php\" method=\"get\">
<input type=\"hidden\" value=\"$matricula\" name=\"matricula\" id=\"matricula\">
<button class=\"btn btn-sm btn-success btn-block\" type=\"submit\" name=\"reload\" role=\"button\"> Tentar novamente? </button>
</form>";


/*if($_SERVER['REQUEST_METHOD'] == "POST") {
    $matricula = $_POST['matricula'];
    $datainicio = $_POST['datainicio'];
    $datafim = $_POST['datafim'];
    $horainicio = $_POST['horainicio'];
    $horafim = $_POST['horafim'];*/
    
    date_default_timezone_set('UTC');
	$sessao = date("His");
	$tabelatemp = "relusuariotemp".$sessao;
	$sqlcreatetemp = "CREATE TEMPORARY TABLE $tabelatemp SELECT * FROM relusuario LIMIT 0;";
	$sqlcreatetempexe = $conn->query($sqlcreatetemp);
	if($sqlcreatetempexe){
    echo "<div class=\"table-responsive\">
        <table class=\"table w-auto\">
        <div class=\"row\"><div class=\"col-sm-4\"><form action=\"exportar__pdf.php\" method=\"post\" target=\"_blank\">

        <button type=\"submit\" name=\"btnexportpdf\" id=\"btnexportpdf\">Exportar PDF</button>
        </form></div>
        <div class=\"col-sm-4\"></div>
        <div class=\"col-sm-4\">$voltar</div>
			</div>
			<div class=\"table-responsive-sm folha a4_vertical\" id=\"relatorio\">
			<table class=\"table w-auto\">
			<tr><td><img src=\"churchill.jpg\" class=\"img-thumbnail\" height=\"84\" width=\"84\"></td>
				<td><p>Condomínio Edifício Sir Winston Churchill<br>
				Avenida Paulista, 807 - Cerqueira Cesar, São Paulo - SP<br>
				<b>Relatório de usuários</b></p>
			</td><tr>
			</table>";


				$number = count($arrayMatriculas);
				// echo $number."<br>";
				$cc = 0;
				while ($cc < $number){
					$datatrini = "2021-05-13";
					$datatrfim = "2022-05-13";
					$horainicio = "00:00:00";
					$horafim = "23:59:59";
					while (strtotime($datatrini) <= strtotime($datatrfim)){
						$datalocal = date('dmY',strtotime($datatrini));
						$datalocal = "d".$datalocal;
					
						$sql  = "insert into $tabelatemp(Nome,Empresa,Matricula,Cartao,ID,Coletor,Data,Hora,Acesso) SELECT Nome,Empresa,Matricula,Cartao,ID,Descricao,Data,Hora,Acesso FROM $datalocal WHERE Matricula='$arrayMatriculas[$cc]' and Hora BETWEEN '$horainicio' and '$horafim'";
						// echo $sql."<br>";
						$sqlexe = $conn->query($sql);
						
						$datatrini = date ("Y-m-d", strtotime("+1 days", strtotime($datatrini)));
						
					} // end while data
					// echo $arrayMatriculas[$cc]."<br>";
					$cc++;
				}
            $sqltempfinal = "select Nome,Empresa,Matricula,count(Matricula) as Visitas from $tabelatemp group by nome,empresa,matricula ORDER BY Nome,Empresa,Visitas ASC";
            // echo $tabelatemp."<br>";
            $sqltempfinalexe = $conn->query($sqltempfinal);
            if($sqltempfinalexe->num_rows > 0){
                echo "<table class=\"table table-sm table-striped table-bordered table-hover\">
                    <thead class=\"thead-light\">
                        <th>Nome</th><th>Empresa</th><th>Matricula</th><th>Acessos</th>
                    </thead>
                    <tbody>";
                while($linhatemp = $sqltempfinalexe->fetch_array(MYSQLI_ASSOC)){
                    $nome = $linhatemp["Nome"];
                    $empresa = $linhatemp["Empresa"];
                    $matricula = $linhatemp["Matricula"];
                    $visitas = $linhatemp["Visitas"];
                echo "<tr><td>$nome</td><td>$empresa</td><td>$matricula</td><td>$visitas</td></tr>";
                } // end while temp
                //$sqltempfinal->close(); //free result set
            } else {// end if temp
                echo "Não foi encontrado nenhum dado no período informado.<br />";
                echo $tentarnovamente."<br />";
            }
			echo "</tbody>";
		echo "</table>";
	} else { // end if Create temp table
		echo "<div class=\"alert alert-danger\" role=\"alert\">Falha na criação da tabela temporária para o relatório.</div><br>$voltar";
	}
$conn->close(); // close connection bd

/*} // end if POST
*/?>
</body>
</html>
<?php
//end file
?>